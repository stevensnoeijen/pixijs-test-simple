var W=Object.defineProperty;var Y=(o,e,t)=>e in o?W(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>(Y(o,typeof e!="symbol"?e+"":e,t),t);import{C as E,T as h,S as g,a as T,h as q,b as K,c as A,A as j,W as X}from"./vendor.e351d44d.js";const $=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}};$();class f extends E{constructor(){super(...arguments);r(this,"number")}}f.schema={number:{type:h.Number,default:0}};class p extends E{constructor(){super(...arguments);r(this,"text")}}p.schema={text:{type:h.Ref}};class w extends E{constructor(){super(...arguments);r(this,"blinkTime");r(this,"removeAfter");r(this,"elapsedTime")}}w.schema={blinkTime:{type:h.Number},removeAfter:{type:h.Number},elapsedTime:{type:h.Number}};class N extends g{constructor(){super(...arguments);r(this,"lastExecuteTime",0)}execute(e,t){for(const i of this.queries.entities.results){const s=i.getMutableComponent(w),n=i.getComponent(p);s.elapsedTime+=t-this.lastExecuteTime,Math.round(s.elapsedTime/s.blinkTime)%2==0?n.text.visible=!0:Math.round(s.elapsedTime/s.blinkTime)%2==1&&(n.text.visible=!1),s.elapsedTime>s.removeAfter&&i.removeComponent(w)}this.lastExecuteTime=t}}N.queries={entities:{components:[w,p]}};class P extends T{}class U extends T{}class m{}r(m,"MUSIC",new q.Howl({src:"music.wav",loop:!0})),r(m,"LEVEL_UP",new q.Howl({src:"levelup.wav"})),r(m,"MARIO_DIE",new q.Howl({src:"mariodie.wav"}));class V extends g{constructor(){super(...arguments);r(this,"level",0)}execute(e,t){this.queries.timer.results[0].getComponent(p).text.text=Math.floor(t/1e3).toString(),this.updateLevel(t),this.queries.gamestatus.results[0].getMutableComponent(f).number=this.level,this.queries.gamestatus.results[0].getComponent(p).text.text=`Level ${this.level}`}updateLevel(e){const t=1+Math.floor(e/1e3/10);this.level!==t&&(this.level=1+Math.floor(e/1e3/10),this.level!==1&&(m.LEVEL_UP.play(),this.queries.gamestatus.results[0].addComponent(w,{blinkTime:250,removeAfter:1500,elapsedTime:0})))}}V.queries={timer:{components:[p,U]},gamestatus:{components:[p,f]}};class M extends T{}class d extends E{constructor(){super(...arguments);r(this,"x");r(this,"y")}}d.schema={x:{type:h.Number,default:0},y:{type:h.Number,default:0}};class l extends E{constructor(){super(...arguments);r(this,"sprite")}}l.schema={sprite:{type:h.Ref}};class D extends g{constructor(e,t){super(e,t);r(this,"application");this.application=t.application}}class _ extends D{execute(e,t){for(const i of this.queries.entities.results){const s=i.getComponent(l);(s.sprite.x<-50||s.sprite.x>this.application.screen.width+50)&&(this.application.stage.removeChild(s.sprite),i.remove())}}}_.queries={entities:{components:[l,d]}};const R=class extends g{constructor(e,t){super(e,t)}execute(e,t){for(const i of this.queries.entities.results){const s=i.getComponent(d),n=i.getComponent(l);n.sprite.x+=s.x*e,n.sprite.y<=R.LEVEL_FLOOR&&(n.sprite.y+=s.y*e)}}};let k=R;r(k,"LEVEL_FLOOR",480);k.queries={entities:{components:[l,d]}};class b extends T{}class z{constructor(e,t){this.application=e,this.world=t}createLevel(){const e=K.from("level.png");return e.scale.set(2.5),this.application.stage.addChildAt(e,0),this.world.createEntity().addComponent(l,{sprite:e})}createTimer(){let e=new A("0");return this.application.stage.addChild(e),e.x=5,e.y=5,this.world.createEntity().addComponent(p,{text:e}).addComponent(U)}createGameStatus(){let e=new A("");return this.application.stage.addChild(e),e.anchor.set(.5),e.x=this.application.screen.width/2,e.y=25,this.world.createEntity().addComponent(p,{text:e}).addComponent(f).addComponent(P)}createMario(){const e=K.from("mario.png");return e.scale.set(.5),e.anchor.set(.5),e.x=this.application.screen.width/2,e.y=this.application.screen.height/2,this.application.stage.addChild(e),this.world.createEntity().addComponent(l,{sprite:e}).addComponent(d,{y:1,x:0}).addComponent(b)}createFish(e=1){const t=K.from("fish.png");t.scale.set(4),t.anchor.set(.5),t.x=Math.random()>.5?800:0,t.y=Math.random()*380+120;const i=t.x===0;return i&&(t.scale.x*=-1),this.application.stage.addChild(t),this.world.createEntity().addComponent(l,{sprite:t}).addComponent(M).addComponent(d,{x:i?e:-e,y:0})}}class c{static addKeyEvent(e){this.keyEvent[e.key.toLowerCase()]={type:e.type,repeat:e.repeat}}static clearKeysStatus(){var e;for(const t of Object.keys(this.keyEvent))((e=this.keyEvent[t])==null?void 0:e.type)==="keyup"&&(this.keyEvent[t]=void 0)}static isKey(e,t,i){var s,n;return((s=this.keyEvent[e])==null?void 0:s.type)===t&&(typeof i=="boolean"?((n=this.keyEvent[e])==null?void 0:n.repeat)===i:!0)}static isKeyDown(e,t){return this.isKey(e,"keydown",t)}static isKeyUp(e,t){return this.isKey(e,"keyup",t)}}r(c,"keyEvent",{});const y=class extends D{execute(e,t){for(const i of this.queries.entities.results){const s=i.getComponent(l),n=i.getMutableComponent(d);c.isKeyDown("a",!1)&&s.sprite.scale.x==.5&&(s.sprite.scale.x*=-1),c.isKeyDown("d",!1)&&s.sprite.scale.x==-.5&&(s.sprite.scale.x/=-1);let u=0,C=0;c.isKeyDown("w")&&(C-=y.MOVE_SPEED*e),c.isKeyDown("s")&&(C+=y.MOVE_SPEED*e),c.isKeyDown("a")&&(u-=y.MOVE_SPEED*e),c.isKeyDown("d")&&(u+=y.MOVE_SPEED*e),c.isKeyUp("m")&&m.MUSIC.mute(!m.MUSIC.mute()),c.isKeyDown("shift")&&(u*=y.SPRINT_MULTIPLIER,C*=y.SPRINT_MULTIPLIER),(u>0&&s.sprite.x<this.application.screen.width-s.sprite.width/2||u<0&&s.sprite.x>0+s.sprite.width/2)&&(s.sprite.x+=u),(C>0&&s.sprite.y<this.application.screen.height-70-s.sprite.height/2||C<0&&s.sprite.y>50+s.sprite.height/2)&&(s.sprite.y+=C),c.isKeyUp("a")&&(n.x=-1),c.isKeyUp("d")&&(n.x=1),n.x!==0&&(n.x>0?n.x-=.1*(e/10):n.x<0&&(n.x+=.1*(e/10)))}}};let v=y;r(v,"MOVE_SPEED",2),r(v,"SPRINT_MULTIPLIER",2);v.queries={entities:{components:[b,l,d]}};class J extends g{constructor(e,t){super(e,t);r(this,"keyQueue",[]);window.addEventListener("keydown",i=>{this.keyQueue.push(i)}),window.addEventListener("keyup",i=>{this.keyQueue.push(i)})}execute(e,t){if(c.clearKeysStatus(),this.keyQueue.length>0){let i;for(;i=this.keyQueue.pop();)c.addKeyEvent(i);this.keyQueue=[]}}}const I=class extends D{constructor(e,t){super(e,t);r(this,"entityFactory");r(this,"lastSpawnTime",0);r(this,"level",0);this.entityFactory=t.entityFactory}execute(e,t){this.level=this.queries.level.results[0].getComponent(f).number,this.shouldRespawn(t)&&this.spawnFish(t)}shouldRespawn(e){return this.queries.enemies.results.length<this.level*I.FISH_PER_LEVEL&&this.lastSpawnTime+(I.SPAWN_DELAY-this.level*25)<e}spawnFish(e){this.entityFactory.createFish(this.level>2?1+Math.random()*this.level/2:void 0),this.lastSpawnTime=e}};let S=I;r(S,"SPAWN_DELAY",1200),r(S,"FISH_PER_LEVEL",3);S.queries={enemies:{components:[l,M]},level:{components:[f]}};const Z=(o,e,t)=>{const i=o.getBounds(),s=e.getBounds();return i.x+i.width-t>s.x&&i.x<s.x+s.width-t&&i.y+i.height-t>s.y&&i.y<s.y+s.height-t};class B extends g{execute(e,t){const i=this.queries.player.results[0];for(const s of this.queries.enemies.results)if(Z(i.getComponent(l).sprite,s.getComponent(l).sprite,25)){const n=this.queries.gamestatus.results[0].getComponent(p).text;m.MUSIC.stop(),m.MARIO_DIE.play(),n.text="GAME OVER",n.style.fill="red",i.alive=!1,this.world.stop()}}}B.queries={enemies:{components:[l,M]},player:{components:[l,b]},gamestatus:{components:[P,p]}};const x=new j;var G;(G=document.getElementById("app"))==null||G.appendChild(x.view);const a=new X;a.registerComponent(b);a.registerComponent(l);a.registerComponent(d);a.registerComponent(M);a.registerComponent(p);a.registerComponent(U);a.registerComponent(P);a.registerComponent(w);a.registerComponent(f);const L=new z(x,a);a.registerSystem(J);a.registerSystem(v,{application:x});a.registerSystem(k);a.registerSystem(_,{application:x});a.registerSystem(S,{application:x,entityFactory:L});a.registerSystem(B);a.registerSystem(V);a.registerSystem(N);L.createLevel();L.createTimer();const ee=L.createGameStatus(),te=L.createMario();m.MUSIC.play();let O=!1,Q=0,F=performance.now();x.ticker.add(o=>{O||(Q+=performance.now()-F,a.execute(o,Q),F=performance.now())});x.start();const H=ee.getComponent(p).text;window.onfocus=()=>{!te.alive||(F=performance.now(),H.text="",a.play(),O=!1,m.MUSIC.playing()||m.MUSIC.play())};window.onblur=()=>{O=!0,H.text="PAUSE",m.MUSIC.pause(),a.stop()};
